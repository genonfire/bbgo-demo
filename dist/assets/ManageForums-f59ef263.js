import{N as O}from"./NumberPagination-a91fcdac.js";import{A as L}from"./ActiveSelector-394afd7c.js";import{u as k}from"./rules-d6c48776.js";import{u as w}from"./datetime-87f6df03.js";import{r as U,o as p,c as h,w as i,a as l,b as f,t as s,V as A,d as m,e as T,f as P,F as $,g as _,M as q}from"./index-cd0f3d5b.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";import{V as B}from"./VContainer-e9bae796.js";import{V as d}from"./VCol-aa336778.js";import{V,a as y,s as Y}from"./forwardRefs-540210a6.js";import{V as c}from"./VRow-9dd703d4.js";import{V as E}from"./VTextField-3cacdb26.js";import{V as x}from"./VTable-d95f7c4d.js";import{V as b}from"./VDialog-f485cea0.js";import{a as K,b as W,V as v}from"./VCard-f27b3ff1.js";import{V as H}from"./VForm-49541c40.js";import{c as R,d as C,V as g}from"./VMenu-9059ef23.js";import{V as G}from"./VCombobox-5cd7cf29.js";import{V as F}from"./VSelect-ed41f246.js";import{V as M}from"./VSwitch-5979da1f.js";import{V as I}from"./VSpacer-0461be1c.js";import"./VField-ffd0fbb4.js";import"./VOverlay-891c21e4.js";import"./ssrBoot-8c3076c6.js";import"./VCheckboxBtn-de07382e.js";import"./VChip-85d324e4.js";const j={setup(){const{rules:e}=k(),{formatDateTime:t,formatDate:a}=w();return{formatDateTime:t,formatDate:a,rules:e}},components:{NumberPagination:O,ActiveSelector:L},data(){return{dialog:!1,deleteDialog:!1,editForNew:!1,managers:[],managerList:[],forums:[],forum:null,pagination:null,pageSize:20,active:null,search:null,validation:!1,init:!1}},computed:{permissions(){return["all","member","staff"]},dialogTitle(){return this.editForNew?this.$t("forum.NEW_FORUM"):this.forum.name}},mounted(){this.getForums(),this.getManagers()},methods:{dataToItems(e){let t=[];for(let a=0;a<e.length;a++){let u={text:e[a].username,value:e[a].id};t.push(u)}return t},itemsToData(e){let t=[];for(let a=0;a<e.length;a++){let u={id:e[a].value};t.push(u)}return t},getManagers(){const e=this;this.$axios({method:this.$api("ADMIN_STAFFS").method,url:this.$api("ADMIN_STAFFS").url}).then(function(t){e.managerList=e.dataToItems(t.data.data)}).catch(function(t){e.$toast.error(e.$error(t,"ADMIN_STAFFS"))})},getForums(e=1){const t=this;let a="";this.search&&(a="&q="+this.search);let u="";this.active&&(u="&active="+this.active);let r=`${this.$api("FORUMS").url}?page_size=${this.pageSize}&page=${e}${u}${a}`;this.$axios({method:this.$api("FORUMS").method,url:r}).then(function(n){t.pagination=n.data.pagination,t.forums=n.data.data,t.init=!0}).catch(function(n){t.$toast.error(t.$error(n,"FORUMS"))})},onEnter(){this.getForums()},getForum(e){const t=this;this.$axios({method:this.$api("FORUM").method,url:this.$api("FORUM").url.replace("{pk}",e)}).then(function(a){t.forum=a.data.data,t.managers=t.dataToItems(a.data.data.managers)}).catch(function(a){t.$toast.error(t.$error(a,"FORUM"))})},newForum(){this.managers=this.dataToItems([this.$store.getUser]),this.forum={name:null,title:null,description:null,managers:this.managers,option:{permission_list:"member",permission_read:"member",permission_write:"member",permission_reply:"member",permission_vote:"member",support_files:!1},is_active:!0},this.editForNew=!0,this.dialog=!0},editForum(e){this.getForum(e.id),this.editForNew=!1,this.dialog=!0},deleteForum(){const e=this;this.$axios({method:this.$api("FORUM_DELETE").method,url:this.$api("FORUM_DELETE").url.replace("{pk}",this.forum.id)}).then(function(t){e.deleteDialog=!1,e.dialog=!1,e.forum=null,e.getForums(),e.$toast.success(e.$t("message.DELETED_SUCCESSFULLY"))}).catch(function(t){e.$toast.error(e.$error(t,"FORUM_DELETE"))})},goForum(e){this.$router.push({name:"thread",params:{forum:e.name}})},save(){const e=this;let t="FORUM_CREATE",a=this.$api(t).url;this.editForNew||(t="FORUM_EDIT",a=this.$api(t).url.replace("{pk}",this.forum.id)),this.forum.managers=this.itemsToData(this.managers),this.$axios({method:this.$api(t).method,url:a,data:this.forum}).then(function(u){e.editForNew?(e.dialog=!1,e.forum=null,e.getForums(),e.$toast.success(e.$t("message.CREATED_SUCCESSFULLY"))):(e.forum=u.data.data,e.managers=e.dataToItems(u.data.data.managers),e.$toast.success(e.$t("message.SAVED_SUCCESSFULLY")))}).catch(function(u){e.$toast.error(e.$error(u,t))})}}},J=["onClick"],Q=["onClick"],X={class:"px-1"},Z={class:"text-body-2 font-weight-medium"},ee={class:"text-body-2 font-weight-medium"},te={class:"text-body-2 font-weight-medium"};function le(e,t,a,u,r,n){const D=U("ActiveSelector"),N=U("NumberPagination");return r.init?(p(),h(B,{key:0},{default:i(()=>[l(c,{style:{"border-bottom":"1px solid #DEE1E6FF"}},{default:i(()=>[l(d,{class:"text-h5 font-weight-bold py-2"},{default:i(()=>[f(s(e.$t("forum.FORUMS")),1)]),_:1}),l(d,{class:"text-right py-2"},{default:i(()=>[l(V,{variant:"outlined","prepend-icon":"mdi-plus",color:"secondary",onClick:n.newForum},{default:i(()=>[f(s(e.$t("action.NEW")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),l(c,{class:"py-2"},{default:i(()=>[l(d,null,{default:i(()=>[l(E,{modelValue:r.search,"onUpdate:modelValue":t[0]||(t[0]=o=>r.search=o),variant:"outlined",density:"compact","hide-details":"","prepend-inner-icon":"mdi-magnify",placeholder:e.$t("hint.SEARCH_NAME_TITLE"),onKeydown:A(n.onEnter,["enter"])},null,8,["modelValue","placeholder","onKeydown"])]),_:1}),l(d,{cols:"2",class:"ml-1 pl-0 pr-3 hidden-sm-and-down"},{default:i(()=>[l(D,{modelValue:r.active,"onUpdate:modelValue":t[1]||(t[1]=o=>r.active=o),getItems:n.getForums},null,8,["modelValue","getItems"])]),_:1})]),_:1}),l(c,null,{default:i(()=>[l(d,null,{default:i(()=>[l(x,{density:"comfortable",hover:!0},{default:i(()=>[m("thead",null,[m("tr",null,[m("th",null,s(e.$t("common.ID")),1),m("th",null,s(e.$t("forum.FORUM_NAME")),1),m("th",null,s(e.$t("forum.FORUM_TITLE")),1),m("th",null,s(e.$t("forum.THREAD_COUNT")),1),m("th",null,s(e.$t("forum.REPLY_COUNT")),1),m("th",null,s(e.$t("common.DATE_CREATED")),1),m("th",null,s(e.$t("common.ACTIVE")),1),m("th",null,s(e.$t("action.EDIT")),1)])]),m("tbody",null,[(p(!0),T($,null,P(r.forums,o=>(p(),T("tr",{key:o.id},[m("td",null,s(o.id),1),m("td",{onClick:S=>n.goForum(o),style:{cursor:"pointer"}},s(o.name),9,J),m("td",{onClick:S=>n.goForum(o),style:{cursor:"pointer"}},s(o.title),9,Q),m("td",null,s(o.thread_count),1),m("td",null,s(o.reply_count),1),m("td",null,s(u.formatDate(o.created_at)),1),m("td",null,[o.is_active?(p(),h(y,{key:0,icon:"mdi-check-circle-outline",color:"success"})):(p(),h(y,{key:1,icon:"mdi-close-circle-outline",color:"error"}))]),m("td",X,[l(V,{flat:"",icon:"mdi-text-box-edit-outline",onClick:S=>n.editForum(o)},null,8,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1}),l(N,{modelValue:r.pageSize,"onUpdate:modelValue":t[2]||(t[2]=o=>r.pageSize=o),pagination:r.pagination,getItems:n.getForums},null,8,["modelValue","pagination","getItems"]),r.forum?(p(),h(b,{key:0,modelValue:r.dialog,"onUpdate:modelValue":t[16]||(t[16]=o=>r.dialog=o),"max-width":"500"},{default:i(()=>[l(v,{width:"100%",class:"mx-auto mt-3 pa-6 pt-2"},{default:i(()=>[l(K,{class:"mb-4 text-h6 font-weight-bold text-center"},{default:i(()=>[f(s(n.dialogTitle),1)]),_:1}),l(H,{modelValue:r.validation,"onUpdate:modelValue":t[15]||(t[15]=o=>r.validation=o)},{default:i(()=>[r.editForNew?(p(),h(c,{key:0,class:"my-0"},{default:i(()=>[l(d,null,{default:i(()=>[m("div",Z,s(e.$t("forum.FORUM_NAME")),1),l(E,{modelValue:r.forum.name,"onUpdate:modelValue":t[3]||(t[3]=o=>r.forum.name=o),density:"compact",rules:[u.rules.required,u.rules.alphaNumber]},null,8,["modelValue","rules"])]),_:1})]),_:1})):_("",!0),l(c,{class:"my-0"},{default:i(()=>[l(d,null,{default:i(()=>[m("div",ee,s(e.$t("forum.FORUM_TITLE")),1),l(E,{modelValue:r.forum.title,"onUpdate:modelValue":t[4]||(t[4]=o=>r.forum.title=o),density:"compact",rules:[u.rules.required]},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(c,{class:"my-0"},{default:i(()=>[l(d,null,{default:i(()=>[m("div",te,s(e.$t("forum.FORUM_DESCRIPTION")),1),l(E,{modelValue:r.forum.description,"onUpdate:modelValue":t[5]||(t[5]=o=>r.forum.description=o),density:"compact",rules:[u.rules.required]},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(R,{density:"compact",class:"py-0"},{default:i(()=>[l(C,null,{default:i(()=>[f(s(e.$t("forum.FORUM_MANAGERS")),1)]),_:1}),l(g,{class:"py-0"},{default:i(()=>[l(G,{modelValue:r.managers,"onUpdate:modelValue":t[6]||(t[6]=o=>r.managers=o),multiple:"",items:r.managerList,"item-title":"text","item-value":"value",rules:[u.rules.requiredSelect]},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),l(R,{density:"compact",class:"py-0"},{default:i(()=>[l(C,null,{default:i(()=>[f(s(e.$t("forum.FORUM_OPTIONS")),1)]),_:1}),l(g,{class:"py-0"},{default:i(()=>[l(F,{modelValue:r.forum.option.permission_list,"onUpdate:modelValue":t[7]||(t[7]=o=>r.forum.option.permission_list=o),label:e.$t("forum.PERMISSION_LIST"),items:n.permissions,density:"comfortable"},null,8,["modelValue","label","items"])]),_:1}),l(g,{class:"py-0"},{default:i(()=>[l(F,{modelValue:r.forum.option.permission_read,"onUpdate:modelValue":t[8]||(t[8]=o=>r.forum.option.permission_read=o),label:e.$t("forum.PERMISSION_READ"),items:n.permissions,density:"comfortable"},null,8,["modelValue","label","items"])]),_:1}),l(g,{class:"py-0"},{default:i(()=>[l(F,{modelValue:r.forum.option.permission_write,"onUpdate:modelValue":t[9]||(t[9]=o=>r.forum.option.permission_write=o),label:e.$t("forum.PERMISSION_WRITE"),items:n.permissions,density:"comfortable"},null,8,["modelValue","label","items"])]),_:1}),l(g,{class:"py-0"},{default:i(()=>[l(F,{modelValue:r.forum.option.permission_reply,"onUpdate:modelValue":t[10]||(t[10]=o=>r.forum.option.permission_reply=o),label:e.$t("forum.PERMISSION_REPLY"),items:n.permissions,density:"comfortable"},null,8,["modelValue","label","items"])]),_:1}),l(g,{class:"py-0"},{default:i(()=>[l(c,null,{default:i(()=>[l(d,null,{default:i(()=>[l(M,{modelValue:r.forum.is_active,"onUpdate:modelValue":t[11]||(t[11]=o=>r.forum.is_active=o),label:e.$t("common.ACTIVE"),color:"secondary",class:"pl-3 py-1"},null,8,["modelValue","label"])]),_:1}),l(d,null,{default:i(()=>[l(M,{modelValue:r.forum.option.support_files,"onUpdate:modelValue":t[12]||(t[12]=o=>r.forum.option.support_files=o),label:e.$t("forum.SUPPORT_FILES"),color:"secondary",class:"pl-3 py-1"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1})]),_:1}),l(W,{class:"my-0 pa-0"},{default:i(()=>[l(V,{color:"secondary",block:"",disabled:!r.validation,onClick:n.save},{default:i(()=>[f(s(e.$t("action.SAVE")),1)]),_:1},8,["disabled","onClick"])]),_:1}),r.editForNew?_("",!0):(p(),h(c,{key:1,class:"mt-2"},{default:i(()=>[l(I),l(b,{modelValue:r.deleteDialog,"onUpdate:modelValue":t[14]||(t[14]=o=>r.deleteDialog=o),"max-width":"400",persistent:""},{activator:i(({props:o})=>[l(V,q(o,{variant:"text",color:"pale",size:"small"}),{default:i(()=>[f(s(e.$t("action.DELETE_FORUM")),1)]),_:2},1040)]),default:i(()=>[l(v,{title:e.$t("forum.DELETE_FORUM"),text:e.$t("hint.DELETE_FORUM_DESCRIPTION")},{prepend:i(()=>[l(y,{icon:"mdi-alert",color:"secondary"})]),actions:i(()=>[l(I),l(V,{variant:"outlined",color:"pale",onClick:t[13]||(t[13]=o=>r.deleteDialog=!1)},{default:i(()=>[f(s(e.$t("action.CANCEL")),1)]),_:1}),l(V,{color:"secondary",onClick:n.deleteForum},{default:i(()=>[f(s(e.$t("action.DELETE_FORUM")),1)]),_:1},8,["onClick"])]),_:1},8,["title","text"])]),_:1},8,["modelValue"])]),_:1}))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])):_("",!0)]),_:1})):(p(),h(Y,{key:1,indeterminate:"",height:4,color:"secondary"}))}const Ce=z(j,[["render",le]]);export{Ce as default};
