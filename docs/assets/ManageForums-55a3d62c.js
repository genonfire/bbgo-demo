import{N as O}from"./NumberPagination-725c0352.js";import{A as L}from"./ActiveSelector-846d7c7f.js";import{u as k}from"./rules-b0a6d5c6.js";import{u as w}from"./datetime-87f6df03.js";import{r as S,o as f,c as V,w as r,a as l,b as p,t as s,V as A,d as m,e as T,f as P,F as $,g as _,M as B}from"./index-b7137ed4.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";import{V as Y}from"./VContainer-24aec8ae.js";import{V as d}from"./VCol-b579b353.js";import{V as h,a as y,B as z}from"./forwardRefs-b452bb48.js";import{V as c}from"./VRow-3f802a33.js";import{V as E}from"./VTextField-83b93000.js";import{V as x}from"./VTable-c4f0321d.js";import{V as b}from"./VDialog-4c1d75bb.js";import{a as K,b as W,V as v}from"./VCard-4331e0a1.js";import{V as H}from"./VForm-0758555c.js";import{c as R,d as C,V as g}from"./VMenu-45d141ca.js";import{V as G}from"./VCombobox-dc836c00.js";import{V as F}from"./VSelect-4a3dc8da.js";import{V as M}from"./VSwitch-f1c85895.js";import{V as D}from"./VSpacer-172a79c9.js";import"./VField-3c3f03bd.js";import"./VOverlay-3da7fd39.js";import"./ssrBoot-afe64649.js";import"./VCheckboxBtn-7d7bc7aa.js";import"./VChip-6dd36372.js";const j={setup(){const{rules:e}=k(),{formatDateTime:t,formatDate:a}=w();return{formatDateTime:t,formatDate:a,rules:e}},components:{NumberPagination:O,ActiveSelector:L},data(){return{dialog:!1,deleteDialog:!1,editForNew:!1,managers:[],managerList:[],forums:[],forum:null,pagination:null,pageSize:20,active:null,search:null,validation:!1,init:!1}},computed:{permissions(){return["all","member","staff"]},dialogTitle(){return this.editForNew?this.$t("forum.NEW_FORUM"):this.forum.name}},mounted(){this.getForums(),this.getManagers()},methods:{dataToItems(e){let t=[];for(let a=0;a<e.length;a++){let n={text:e[a].username,value:e[a].id};t.push(n)}return t},itemsToData(e){let t=[];for(let a=0;a<e.length;a++){let n={id:e[a].value};t.push(n)}return t},getManagers(){const e=this;this.$axios({method:this.$api("ADMIN_STAFFS").method,url:this.$api("ADMIN_STAFFS").url+"?"}).then(function(t){e.managerList=e.dataToItems(t.data.data)}).catch(function(t){e.$toast.error(e.$error(t,"ADMIN_STAFFS"))})},getForums(e=1){const t=this;this.search&&""+this.search;let a="";this.active&&(a="active="+this.active);let n=`${this.$api("FORUMS").url}?${a}`;this.$axios({method:this.$api("FORUMS").method,url:n}).then(function(o){t.pagination=o.data.pagination,t.forums=o.data.data,t.init=!0}).catch(function(o){t.$toast.error(t.$error(o,"FORUMS"))})},onEnter(){this.getForums()},getForum(e){const t=this;this.$axios({method:this.$api("FORUM").method,url:this.$api("FORUM").url.replace("{pk}",e)}).then(function(a){t.forum=a.data.data,console.log(t.forum),t.managers=t.dataToItems(a.data.data.managers)}).catch(function(a){t.$toast.error(t.$error(a,"FORUM"))})},newForum(){this.managers=this.dataToItems([this.$store.getUser]),this.forum={name:null,title:null,description:null,managers:this.managers,option:{permission_list:"member",permission_read:"member",permission_write:"member",permission_reply:"member",permission_vote:"member",support_files:!1},is_active:!0},this.editForNew=!0,this.dialog=!0},editForum(e){this.getForum(e.id),this.editForNew=!1,this.dialog=!0},deleteForum(){const e=this;this.$axios({method:this.$api("FORUM_DELETE").method,url:this.$api("FORUM_DELETE").url.replace("{pk}",this.forum.id)}).then(function(t){e.deleteDialog=!1,e.dialog=!1,e.forum=null,e.getForums(),e.$toast.success(e.$t("message.DELETED_SUCCESSFULLY"))}).catch(function(t){e.$toast.error(e.$error(t,"FORUM_DELETE"))})},goForum(e){this.$router.push({name:"thread",params:{forum:e.name}})},save(){const e=this;let t="FORUM_CREATE",a=this.$api(t).url;this.editForNew||(t="FORUM_EDIT",a=this.$api(t).url.replace("{pk}",this.forum.id)),this.forum.managers=this.itemsToData(this.managers),this.$axios({method:this.$api(t).method,url:a,data:this.forum}).then(function(n){e.editForNew?(e.dialog=!1,e.forum=null,e.getForums(),e.$toast.success(e.$t("message.CREATED_SUCCESSFULLY"))):(e.dialog=!1,e.$toast.success(e.$t("message.SAVED_SUCCESSFULLY")))}).catch(function(n){e.$toast.error(e.$error(n,t))})}}},J=["onClick"],Q=["onClick"],X={class:"px-1"},Z={class:"text-body-2 font-weight-medium"},ee={class:"text-body-2 font-weight-medium"},te={class:"text-body-2 font-weight-medium"};function le(e,t,a,n,o,u){const I=S("ActiveSelector"),N=S("NumberPagination");return o.init?(f(),V(Y,{key:0},{default:r(()=>[l(c,{style:{"border-bottom":"1px solid #DEE1E6FF"}},{default:r(()=>[l(d,{class:"text-h5 font-weight-bold py-2"},{default:r(()=>[p(s(e.$t("forum.FORUMS")),1)]),_:1}),l(d,{class:"text-right py-2"},{default:r(()=>[l(h,{variant:"outlined","prepend-icon":"mdi-plus",color:"secondary",onClick:u.newForum},{default:r(()=>[p(s(e.$t("action.NEW")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),l(c,{class:"py-2"},{default:r(()=>[l(d,null,{default:r(()=>[l(E,{modelValue:o.search,"onUpdate:modelValue":t[0]||(t[0]=i=>o.search=i),variant:"outlined",density:"compact","hide-details":"","prepend-inner-icon":"mdi-magnify",placeholder:e.$t("hint.SEARCH_NAME_TITLE"),onKeydown:A(u.onEnter,["enter"])},null,8,["modelValue","placeholder","onKeydown"])]),_:1}),l(d,{cols:"2",class:"ml-1 pl-0 pr-3 hidden-sm-and-down"},{default:r(()=>[l(I,{modelValue:o.active,"onUpdate:modelValue":t[1]||(t[1]=i=>o.active=i),getItems:u.getForums},null,8,["modelValue","getItems"])]),_:1})]),_:1}),l(c,null,{default:r(()=>[l(d,null,{default:r(()=>[l(x,{density:"comfortable",hover:!0},{default:r(()=>[m("thead",null,[m("tr",null,[m("th",null,s(e.$t("common.ID")),1),m("th",null,s(e.$t("forum.FORUM_NAME")),1),m("th",null,s(e.$t("forum.FORUM_TITLE")),1),m("th",null,s(e.$t("forum.THREAD_COUNT")),1),m("th",null,s(e.$t("forum.REPLY_COUNT")),1),m("th",null,s(e.$t("common.DATE_CREATED")),1),m("th",null,s(e.$t("common.ACTIVE")),1),m("th",null,s(e.$t("action.EDIT")),1)])]),m("tbody",null,[(f(!0),T($,null,P(o.forums,i=>(f(),T("tr",{key:i.id},[m("td",null,s(i.id),1),m("td",{onClick:U=>u.goForum(i),style:{cursor:"pointer"}},s(i.name),9,J),m("td",{onClick:U=>u.goForum(i),style:{cursor:"pointer"}},s(i.title),9,Q),m("td",null,s(i.thread_count),1),m("td",null,s(i.reply_count),1),m("td",null,s(n.formatDate(i.created_at)),1),m("td",null,[i.is_active?(f(),V(y,{key:0,icon:"mdi-check-circle-outline",color:"success"})):(f(),V(y,{key:1,icon:"mdi-close-circle-outline",color:"error"}))]),m("td",X,[l(h,{flat:"",icon:"mdi-text-box-edit-outline",onClick:U=>u.editForum(i)},null,8,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1}),l(N,{modelValue:o.pageSize,"onUpdate:modelValue":t[2]||(t[2]=i=>o.pageSize=i),pagination:o.pagination,getItems:u.getForums},null,8,["modelValue","pagination","getItems"]),o.forum?(f(),V(b,{key:0,modelValue:o.dialog,"onUpdate:modelValue":t[16]||(t[16]=i=>o.dialog=i),"max-width":"500"},{default:r(()=>[l(v,{width:"100%",class:"mx-auto mt-3 pa-6 pt-2"},{default:r(()=>[l(K,{class:"mb-4 text-h6 font-weight-bold text-center"},{default:r(()=>[p(s(u.dialogTitle),1)]),_:1}),l(H,{modelValue:o.validation,"onUpdate:modelValue":t[15]||(t[15]=i=>o.validation=i)},{default:r(()=>[o.editForNew?(f(),V(c,{key:0,class:"my-0"},{default:r(()=>[l(d,null,{default:r(()=>[m("div",Z,s(e.$t("forum.FORUM_NAME")),1),l(E,{modelValue:o.forum.name,"onUpdate:modelValue":t[3]||(t[3]=i=>o.forum.name=i),density:"compact",rules:[n.rules.required,n.rules.alphaNumber]},null,8,["modelValue","rules"])]),_:1})]),_:1})):_("",!0),l(c,{class:"my-0"},{default:r(()=>[l(d,null,{default:r(()=>[m("div",ee,s(e.$t("forum.FORUM_TITLE")),1),l(E,{modelValue:o.forum.title,"onUpdate:modelValue":t[4]||(t[4]=i=>o.forum.title=i),density:"compact",rules:[n.rules.required]},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(c,{class:"my-0"},{default:r(()=>[l(d,null,{default:r(()=>[m("div",te,s(e.$t("forum.FORUM_DESCRIPTION")),1),l(E,{modelValue:o.forum.description,"onUpdate:modelValue":t[5]||(t[5]=i=>o.forum.description=i),density:"compact",rules:[n.rules.required]},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(R,{density:"compact",class:"py-0"},{default:r(()=>[l(C,null,{default:r(()=>[p(s(e.$t("forum.FORUM_MANAGERS")),1)]),_:1}),l(g,{class:"py-0"},{default:r(()=>[l(G,{modelValue:o.managers,"onUpdate:modelValue":t[6]||(t[6]=i=>o.managers=i),multiple:"",items:o.managerList,"item-title":"text","item-value":"value",rules:[n.rules.requiredSelect]},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),l(R,{density:"compact",class:"py-0"},{default:r(()=>[l(C,null,{default:r(()=>[p(s(e.$t("forum.FORUM_OPTIONS")),1)]),_:1}),l(g,{class:"py-0"},{default:r(()=>[l(F,{modelValue:o.forum.option.permission_list,"onUpdate:modelValue":t[7]||(t[7]=i=>o.forum.option.permission_list=i),label:e.$t("forum.PERMISSION_LIST"),items:u.permissions,density:"comfortable"},null,8,["modelValue","label","items"])]),_:1}),l(g,{class:"py-0"},{default:r(()=>[l(F,{modelValue:o.forum.option.permission_read,"onUpdate:modelValue":t[8]||(t[8]=i=>o.forum.option.permission_read=i),label:e.$t("forum.PERMISSION_READ"),items:u.permissions,density:"comfortable"},null,8,["modelValue","label","items"])]),_:1}),l(g,{class:"py-0"},{default:r(()=>[l(F,{modelValue:o.forum.option.permission_write,"onUpdate:modelValue":t[9]||(t[9]=i=>o.forum.option.permission_write=i),label:e.$t("forum.PERMISSION_WRITE"),items:u.permissions,density:"comfortable"},null,8,["modelValue","label","items"])]),_:1}),l(g,{class:"py-0"},{default:r(()=>[l(F,{modelValue:o.forum.option.permission_reply,"onUpdate:modelValue":t[10]||(t[10]=i=>o.forum.option.permission_reply=i),label:e.$t("forum.PERMISSION_REPLY"),items:u.permissions,density:"comfortable"},null,8,["modelValue","label","items"])]),_:1}),l(g,{class:"py-0"},{default:r(()=>[l(c,null,{default:r(()=>[l(d,null,{default:r(()=>[l(M,{modelValue:o.forum.is_active,"onUpdate:modelValue":t[11]||(t[11]=i=>o.forum.is_active=i),label:e.$t("common.ACTIVE"),color:"secondary",class:"pl-3 py-1"},null,8,["modelValue","label"])]),_:1}),l(d,null,{default:r(()=>[l(M,{modelValue:o.forum.option.support_files,"onUpdate:modelValue":t[12]||(t[12]=i=>o.forum.option.support_files=i),label:e.$t("forum.SUPPORT_FILES"),color:"secondary",class:"pl-3 py-1"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1})]),_:1}),l(W,{class:"my-0 pa-0"},{default:r(()=>[l(h,{color:"secondary",block:"",disabled:!o.validation,onClick:u.save},{default:r(()=>[p(s(e.$t("action.SAVE")),1)]),_:1},8,["disabled","onClick"])]),_:1}),o.editForNew?_("",!0):(f(),V(c,{key:1,class:"mt-2"},{default:r(()=>[l(D),l(b,{modelValue:o.deleteDialog,"onUpdate:modelValue":t[14]||(t[14]=i=>o.deleteDialog=i),"max-width":"400",persistent:""},{activator:r(({props:i})=>[l(h,B(i,{variant:"text",color:"pale",size:"small"}),{default:r(()=>[p(s(e.$t("action.DELETE_FORUM")),1)]),_:2},1040)]),default:r(()=>[l(v,{title:e.$t("forum.DELETE_FORUM"),text:e.$t("hint.DELETE_FORUM_DESCRIPTION")},{prepend:r(()=>[l(y,{icon:"mdi-alert",color:"secondary"})]),actions:r(()=>[l(D),l(h,{variant:"outlined",color:"pale",onClick:t[13]||(t[13]=i=>o.deleteDialog=!1)},{default:r(()=>[p(s(e.$t("action.CANCEL")),1)]),_:1}),l(h,{color:"secondary",onClick:u.deleteForum},{default:r(()=>[p(s(e.$t("action.DELETE_FORUM")),1)]),_:1},8,["onClick"])]),_:1},8,["title","text"])]),_:1},8,["modelValue"])]),_:1}))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])):_("",!0)]),_:1})):(f(),V(z,{key:1,indeterminate:"",height:4,color:"secondary"}))}const Ce=q(j,[["render",le]]);export{Ce as default};
