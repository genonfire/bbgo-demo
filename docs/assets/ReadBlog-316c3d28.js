import{u as D}from"./datetime-87f6df03.js";import{O as B,V as v}from"./VTextarea-2bf0bc19.js";import{u as M}from"./user-12dc24db.js";import{_ as $}from"./plugin-vue_export-helper-c27b6911.js";import{a as T}from"./VChip-6dd36372.js";import{V as u,B as S,a as w}from"./forwardRefs-b452bb48.js";import{V as O}from"./VContainer-24aec8ae.js";import{V,c as k,b as x}from"./VCard-4331e0a1.js";import{r as y,o as c,c as h,w as l,d as p,a as n,b as m,t as a,e as b,g,f as N,F as G,a0 as A}from"./index-b7137ed4.js";import{T as U}from"./TagChips-2898481e.js";import{V as C}from"./VCol-b579b353.js";import{V as E}from"./VRow-3f802a33.js";import{V as I}from"./VSheet-fcfa7ac1.js";import{V as R}from"./VSpacer-172a79c9.js";import{V as F}from"./VDialog-4c1d75bb.js";import"./VField-3c3f03bd.js";import"./VOverlay-3da7fd39.js";const K={props:{blog:Object},setup(){const{formatDateOrTime:e}=D(),{username:t}=M();return{formatDateOrTime:e,username:t}},components:{Observer:B},data(){return{commentCount:this.blog.comment_count||0,comments:null,dataStored:[],nextLink:null,pageSize:50,init:!1,loading:!1,newComment:null,commenting:!1,textareas:[],replying:[],scrollTo:null}},mounted(){this.getComments(),this.$route.params.comment&&(this.scrollTo="comment-"+this.$route.params.comment)},methods:{scrollToComment(){const e=document.getElementById(this.scrollTo);e&&e.scrollIntoView({behavior:"smooth",block:"start"}),this.scrollTo=null},getComments(){const e=this,t=`${this.$api("BLOG_COMMENTS").url.replace("{pk}",this.blog.id)}?page_size=${this.pageSize}`;this.$axios({method:this.$api("BLOG_COMMENTS").method,url:t}).then(function(s){e.nextLink=s.data.pagination.next_link,e.comments=s.data.data,e.replying=new Array(e.comments.length).fill(!1),e.textareas=new Array(e.comments.length).fill(null),e.commenting=!1,e.newComment=null,e.init=!0,e.scrollTo&&setTimeout(e.scrollToComment,300)}).catch(function(s){e.$toast.error(e.$error(s,"BLOG_COMMENTS"))})},updateData(){this.commentCount=this.comments.length,this.replying=new Array(this.comments.length).fill(!1),this.textareas=new Array(this.comments.length).fill(null),this.commenting=!1,this.newComment=null,this.loading=!1},getMoreComments(){if(!this.nextLink)return;const e=this;this.loading=!0,this.$axios({method:this.$api("BLOG_COMMENTS").method,url:this.nextLink}).then(function(t){e.nextLink=t.data.pagination.next_link,e.dataStored=t.data.data,setTimeout(e.updateData,1e3)}).catch(function(t){e.$toast.error(e.$error(t,"BLOG_COMMENTS"))})},cancelComment(e){e==-1?(this.commenting=!1,this.newComment=null):(this.replying[e]=!1,this.textareas[e]=null)},saveComment(e,t){const s=this;let f={comment_id:t,content:this.textareas[e]};e==-1&&(f={content:this.newComment}),this.$axios({method:this.$api("BLOG_COMMENT").method,url:this.$api("BLOG_COMMENT").url.replace("{pk}",this.blog.id),data:f}).then(function(o){let r=f;r.id=s.comments.length+1,r.blog=s.blog,r.user={id:2,username:"1@a.com",call_name:"John Doe"},r.is_deleted=!1,r.date_or_time={date:null,time:new Date().toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0})},r.editable=!0,s.comments.splice(e+1,0,r),s.updateData()}).catch(function(o){s.$toast.error(s.$error(o,"BLOG_COMMENT"))})},deleteComment(e,t){const s=this;confirm(this.$t("blog.DELETE_COMMENT"))&&this.$axios({method:this.$api("DELETE_COMMENT").method,url:this.$api("DELETE_COMMENT").url.replace("{pk}",e)}).then(function(f){s.comments[t].is_deleted=!0,s.updateData(),s.$toast.success(s.$t("message.REAL_DELETED_SUCCESSFULLY"))}).catch(function(f){s.$toast.error(s.$error(f,"DELETE_COMMENT"))})}}},Y={key:1,class:"text-right"},z={class:"font-weight-bold"},H={style:{color:"#565E6C"}},P={key:0,class:"text-right"},j={key:0};function J(e,t,s,f,o,r){const L=y("Observer");return c(),h(O,{class:"pa-0"},{default:l(()=>[p("div",null,[n(T,{variant:"flat",color:"neutral","prepend-icon":"mdi-message-reply-outline",class:"px-4 mr-2"},{default:l(()=>[m(a(o.commentCount),1)]),_:1}),(c(),h(u,{key:0,variant:"outlined","prepend-icon":"mdi-plus",color:"secondary",class:"my-5",onClick:t[0]||(t[0]=i=>o.commenting=!0)},{default:l(()=>[m(a(e.$t("blog.ADD_COMMENT")),1)]),_:1})),o.commenting?(c(),b("div",Y,[n(v,{modelValue:o.newComment,"onUpdate:modelValue":t[1]||(t[1]=i=>o.newComment=i),rows:"3",variant:"outlined"},null,8,["modelValue"]),n(u,{variant:"flat",density:"comfortable",color:"ashen",class:"mr-2",onClick:t[2]||(t[2]=i=>r.cancelComment(-1))},{default:l(()=>[m(a(e.$t("action.CANCEL")),1)]),_:1}),n(u,{variant:"flat",density:"comfortable",color:"secondary",onClick:t[3]||(t[3]=i=>r.saveComment(-1,0)),disabled:!o.newComment},{default:l(()=>[m(a(e.$t("action.SAVE")),1)]),_:1},8,["disabled"])])):g("",!0)]),(c(!0),b(G,null,N(o.comments,(i,d)=>(c(),h(V,{variant:"flat",key:i.id,id:"comment-"+i.id,class:A(i.comment_id?"ml-5":""),disabled:i.is_deleted},{default:l(()=>[n(k,{class:"pb-2"},{default:l(()=>[i.user&&i.user.id==s.blog.user.id?(c(),h(T,{key:0,variant:"flat",density:"compact",color:"secondary",class:"mr-2 px-2"},{default:l(()=>[m(a(e.$t("blog.AUTHOR")),1)]),_:1})):g("",!0),p("span",z,a(f.username(i)),1),p("span",H," - "+a(f.formatDateOrTime(i.date_or_time)),1)]),_:2},1024),i.is_deleted?(c(),h(k,{key:1,class:"py-1"},{default:l(()=>[m(a(e.$t("blog.DELETED_COMMENT")),1)]),_:1})):(c(),h(k,{key:0,class:"py-1"},{default:l(()=>[m(a(i.content)+" ",1),n(x,{class:"pl-0 d-flex"},{default:l(()=>[n(u,{variant:"text","prepend-icon":"mdi-message-reply-outline",onClick:_=>o.replying[d]=!0},{default:l(()=>[m(a(e.$t("blog.REPLY")),1)]),_:2},1032,["onClick"]),i.editable?(c(),h(u,{key:0,variant:"text","prepend-icon":"mdi-trash-can-outline",color:"secondary",onClick:_=>r.deleteComment(i.id,d)},{default:l(()=>[m(a(e.$t("action.DELETE")),1)]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024),o.replying[d]?(c(),b("div",P,[n(v,{modelValue:o.textareas[d],"onUpdate:modelValue":_=>o.textareas[d]=_,rows:"3",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"]),n(u,{variant:"flat",density:"comfortable",color:"ashen",class:"mr-2",onClick:_=>r.cancelComment(d)},{default:l(()=>[m(a(e.$t("action.CANCEL")),1)]),_:2},1032,["onClick"]),n(u,{variant:"flat",density:"comfortable",color:"secondary",onClick:_=>r.saveComment(d,i.id),disabled:!o.textareas[d]},{default:l(()=>[m(a(e.$t("action.SAVE")),1)]),_:2},1032,["onClick","disabled"])])):g("",!0)]),_:2},1024))]),_:2},1032,["id","class","disabled"]))),128)),o.loading?(c(),b("div",j,[n(S,{indeterminate:"",height:1,color:"secondary"})])):g("",!0),n(L,{onShow:r.getMoreComments},null,8,["onShow"])]),_:1})}const q=$(K,[["render",J],["__scopeId","data-v-b4ad9a67"]]);const Q={setup(){const{formatDate:e}=D();return{formatDate:e}},components:{Comment:q,TagChips:U},data(){return{blog:null,like:0,liked:!1,deleteDialog:!1,init:!1}},mounted(){this.getBlog(this.$route.params.blog)},methods:{getBlog(e){const t=this;this.$axios({method:this.$api("READ_BLOG").method,url:this.$api("READ_BLOG").url.replace("{pk}",e)}).then(function(s){t.blog=s.data.data,t.like=t.blog.like,t.liked=t.blog.liked,t.init=!0}).catch(function(s){t.$toast.error(t.$error(s,"READ_BLOG"))})},likeBlog(){if(this.liked){this.$toast.info(this.$t("error.ALREADY_LIKED"));return}const e=this;this.$axios({method:this.$api("LIKE_BLOG").method,url:this.$api("LIKE_BLOG").url.replace("{pk}",this.blog.id)}).then(function(t){e.like=t.data.data.like,e.liked=!0,e.$toast.success(e.$t("message.LIKED_SUCCESSFULLY"))}).catch(function(t){e.$toast.error(e.$error(t,"LIKE_BLOG"))})},deleteBlog(){const e=this;this.$axios({method:this.$api("DELETE_BLOG").method,url:this.$api("DELETE_BLOG").url.replace("{pk}",this.blog.id)}).then(function(t){e.deleteDialog=!1,e.$router.replace({name:"blogs"}),e.$toast.success(e.$t("message.DELETED_SUCCESSFULLY"))}).catch(function(t){e.$toast.error(e.$error(t,"DELETE_BLOG"))})}}},W={class:"mb-1 text-secondary"},X={class:"text-h4 font-weight-medium"},Z={class:"my-3 text-body-2"},ee={class:"mx-2"},te={class:"font-italic text-decoration-underline"},oe={class:"ml-2 text-pale"},le=["src"];function ne(e,t,s,f,o,r){const L=y("TagChips"),i=y("Comment");return o.init?(c(),h(O,{key:0},{default:l(()=>[n(E,null,{default:l(()=>[n(C,{class:"my-4 d-flex flex-column"},{default:l(()=>[p("div",W,a(o.blog.category),1),p("div",X,a(o.blog.title),1),p("div",Z,[p("span",ee,[m(" By "),p("span",te,a(o.blog.user.call_name),1)]),p("span",oe,a(f.formatDate(o.blog.created_at)),1)])]),_:1})]),_:1}),n(E,{class:"my-0"},{default:l(()=>[n(C,null,{default:l(()=>[o.blog.image?(c(),b("img",{key:0,src:o.blog.image.file,width:"320",style:{"max-width":"100%"}},null,8,le)):g("",!0)]),_:1})]),_:1}),n(E,null,{default:l(()=>[n(C,null,{default:l(()=>[n(I,{class:"editor-content",innerHTML:o.blog.content},null,8,["innerHTML"])]),_:1})]),_:1}),n(E,{class:"my-10"},{default:l(()=>[n(C,null,{default:l(()=>[n(L,{tags:o.blog.tags,label:!0},null,8,["tags"])]),_:1})]),_:1}),n(E,null,{default:l(()=>[n(C,{class:"text-center"},{default:l(()=>[n(u,{variant:"flat","prepend-icon":"mdi-thumb-up-outline",color:o.liked?"secondary":"neutral",onClick:r.likeBlog},{default:l(()=>[m(a(o.like),1)]),_:1},8,["color","onClick"]),o.blog.editable?(c(),h(u,{key:0,variant:"flat",color:"neutral",class:"mx-2",onClick:t[0]||(t[0]=d=>e.$router.push({name:"blog.edit",params:{blog:o.blog.id}}))},{default:l(()=>[m(a(e.$t("action.EDIT")),1)]),_:1})):g("",!0),o.blog.editable?(c(),h(u,{key:1,variant:"flat",color:"secondary",onClick:t[1]||(t[1]=d=>o.deleteDialog=!0)},{default:l(()=>[m(a(e.$t("action.DELETE")),1)]),_:1})):g("",!0)]),_:1})]),_:1}),n(F,{modelValue:o.deleteDialog,"onUpdate:modelValue":t[4]||(t[4]=d=>o.deleteDialog=d),"max-width":"400",persistent:""},{default:l(()=>[n(V,{title:e.$t("blog.DELETE_BLOG"),text:e.$t("hint.DELETE_BLOG_DESCRIPTION")},{prepend:l(()=>[n(w,{icon:"mdi-alert",color:"secondary"})]),actions:l(()=>[n(R),n(u,{variant:"outlined",color:"pale",onClick:t[2]||(t[2]=d=>o.deleteDialog=!1)},{default:l(()=>[m(a(e.$t("action.CANCEL")),1)]),_:1}),n(u,{color:"secondary",onClick:t[3]||(t[3]=d=>r.deleteBlog())},{default:l(()=>[m(a(e.$t("action.DELETE_BLOG")),1)]),_:1})]),_:1},8,["title","text"])]),_:1},8,["modelValue"]),n(i,{blog:o.blog},null,8,["blog"])]),_:1})):g("",!0)}const ke=$(Q,[["render",ne]]);export{ke as default};
