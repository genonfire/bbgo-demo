import{T as v}from"./Tiptap-2f9ce1cf.js";import{u as A}from"./file-481382df.js";import{_ as $}from"./_plugin-vue_export-helper-c27b6911.js";import{V as H}from"./VContainer-f8abdc09.js";import{V as p}from"./VCol-e00bcbf1.js";import{V as L}from"./VTextField-61eec21d.js";import{V as u}from"./VRow-19d851c3.js";import{V as E,c as V}from"./VCard-4cfd500e.js";import{a as C,V as g}from"./forwardRefs-924807e8.js";import{a as I}from"./VChip-4e03b0ad.js";import{r as R,o as d,c as f,w as a,g as h,a as s,e as _,F,f as S,b as c,t as m}from"./index-19cdb70b.js";import"./VTooltip-a726537b.js";import"./VOverlay-545b978e.js";import"./VField-53be84f4.js";import"./VTabs-f5dd1bab.js";import"./ssrBoot-cad1a3e9.js";import"./VFileInput-e44d8e73.js";import"./VSpacer-7e748533.js";import"./VDialog-43c5c180.js";const k={setup(){const{fileSize:e}=A();return{fileSize:e}},components:{Tiptap:v},data(){return{thread:null,options:{content:""},fileChips:[],isHovering:!1,saved:!1,init:!1}},mounted(){this.getThread(this.$route.params.forum,this.$route.params.thread)},beforeRouteLeave(e,t,r){this.saved||confirm(this.$t("forum.QUIT_EDITING"))?r():r(!1)},methods:{getThread(e,t){const r=this;this.$axios({method:this.$api("THREAD_READ").method,url:this.$api("THREAD_READ").url.replace("{forum}",e).replace("{pk}",t)}).then(function(i){r.thread=i.data.data,r.options.content=r.thread.content,r.fileChips=r.thread.files,r.init=!0}).catch(function(i){r.$toast.error(r.$error(i,"THREAD_READ"))})},save(){const e=this;this.$axios({method:this.$api("THREAD_EDIT").method,url:this.$api("THREAD_EDIT").url.replace("{forum}",this.thread.forum.name).replace("{pk}",this.thread.id),data:{title:this.thread.title,content:this.options.content}}).then(function(t){e.saved=!0,e.$toast.success(e.$t("message.SAVED_SUCCESSFULLY")),e.$router.back()}).catch(function(t){e.$toast.error(e.$error(t,"THREAD_EDIT"))})},allowDrop(e){e.preventDefault(),this.isHovering=!0},leaveDrop(e){e.preventDefault(),this.isHovering=!1},handleFileDrop(e){const t=this;if(this.isHovering=!1,this.thread.forum.support_files){e.preventDefault();for(let r=0;r<e.dataTransfer.files.length;r++){let i=new FormData;i.append("file",e.dataTransfer.files[r]),this.$axios({method:this.$api("FILE_UPLOAD").method,url:this.$api("FILE_UPLOAD").url,data:i}).then(function(o){t.thread.files.push(o.data.data),t.$axios({method:t.$api("THREAD_ATTACH_FILES").method,url:t.$api("THREAD_ATTACH_FILES").url.replace("{forum}",t.thread.forum.name).replace("{pk}",t.thread.id),data:{files:[{id:o.data.data.id}]}}).then(function(l){}).catch(function(l){t.$toast.error(t.$error(l,"THREAD_ATTACH_FILES"))})}).catch(function(o){t.$toast.error(t.$error(o,"FILE_UPLOAD"))})}}},removeItem(e){const t=this;this.$axios({method:this.$api("THREAD_DELETE_FILES").method,url:this.$api("THREAD_DELETE_FILES").url.replace("{forum}",this.thread.forum.name).replace("{pk}",this.thread.id),data:{files:[{id:e.id}]}}).then(function(r){t.saved=!0,t.$toast.success(t.$t("message.DELETED_SUCCESSFULLY"))}).catch(function(r){t.$toast.error(t.$error(r,"THREAD_DELETE_FILES"))})}}},y={key:0,class:"pl-2"};function x(e,t,r,i,o,l){const D=R("Tiptap");return o.init?(d(),f(H,{key:0},{default:a(()=>[s(u,{class:"mt-0"},{default:a(()=>[s(p,null,{default:a(()=>[s(L,{modelValue:o.thread.title,"onUpdate:modelValue":t[0]||(t[0]=n=>o.thread.title=n),variant:"outlined",density:"compact",placeholder:e.$t("forum.THREAD_TITLE")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),s(u,{class:"mt-0"},{default:a(()=>[s(p,null,{default:a(()=>[s(D,{options:o.options},null,8,["options"])]),_:1})]),_:1}),o.thread.forum.support_files?(d(),f(u,{key:0},{default:a(()=>[s(p,null,{default:a(()=>[s(E,{title:e.$t("forum.ATTACHMENTS"),variant:"outlined",density:"compact",class:"rounded-lg border-dashed"},{default:a(()=>[o.thread.files?(d(),_("div",y,[(d(!0),_(F,null,S(o.fileChips,n=>(d(),f(I,{key:n.id,variant:"tonal",class:"mx-1 my-1",closable:"","onClick:close":T=>l.removeItem(n),"onUpdate:modelValue":T=>!0},{default:a(()=>[c(m(n.filename)+" ("+m(i.fileSize(n.size))+") ",1)]),_:2},1032,["onClick:close"]))),128))])):h("",!0),s(E,{variant:"outlined",density:"compact",color:o.isHovering?"secondary":void 0,class:"ma-2 pa-3 rounded-lg border-dashed text-center",onDrop:l.handleFileDrop,onDragover:l.allowDrop,onDragleave:l.leaveDrop},{default:a(()=>[s(C,{size:"x-large",color:o.isHovering?"secondary":"pale"},{default:a(()=>[c(" mdi-cloud-upload-outline ")]),_:1},8,["color"]),s(V,{class:"mt-2 pa-1"},{default:a(()=>[c(m(e.$t("hint.DROP_FILES_HERE")),1)]),_:1})]),_:1},8,["color","onDrop","onDragover","onDragleave"])]),_:1},8,["title"])]),_:1})]),_:1})):h("",!0),s(u,{class:"my-10"},{default:a(()=>[s(p,{class:"text-right"},{default:a(()=>[s(g,{color:"secondary",class:"px-8",onClick:l.save,disabled:!o.thread.title||!o.options.content},{default:a(()=>[c(m(e.$t("action.SAVE")),1)]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})):h("",!0)}const ee=$(k,[["render",x]]);export{ee as default};
