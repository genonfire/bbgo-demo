import{u as V}from"./datetime-87f6df03.js";import{u as I}from"./download-8c853526.js";import{u as O}from"./file-481382df.js";import{u as S}from"./user-12dc24db.js";import{O as U,V as $}from"./VTextarea-55db8846.js";import{_ as w}from"./plugin-vue_export-helper-c27b6911.js";import{a as C}from"./VChip-ec8b5f79.js";import{V as p,B as F,a as A}from"./forwardRefs-601a00f7.js";import{V as x}from"./VContainer-5b7520f1.js";import{V as v,c as g,b as Y,a as M}from"./VCard-70e41233.js";import{r as L,o as n,c as h,w as o,d as E,a as s,b as c,t as l,g as f,e as T,f as H,F as P,a0 as N,M as b}from"./index-9a7d77d1.js";import{V as y}from"./VCol-c72717e7.js";import{V as k}from"./VTooltip-4289a088.js";import{V as D}from"./VRow-93a26ab0.js";import{V as z}from"./VSheet-b118c539.js";import{V as B}from"./VSpacer-4d8b3bfe.js";import{V as G}from"./VDialog-a1cc2a02.js";import"./VField-28f70089.js";import"./VOverlay-bfd1bd36.js";const j={props:{thread:Object},setup(){const{formatDateOrTime:e}=V(),{username:t}=S();return{formatDateOrTime:e,username:t}},components:{Observer:U},data(){return{replyCount:this.thread.reply_count||0,replies:null,dataStored:[],nextLink:null,pageSize:50,init:!1,loading:!1,newComment:null,commenting:!1,textareas:[],replying:[],scrollTo:null}},mounted(){this.getReplies(),this.$route.params.reply&&(this.scrollTo="reply-"+this.$route.params.reply)},methods:{scrollToReply(){const e=document.getElementById(this.scrollTo);e&&e.scrollIntoView({behavior:"smooth",block:"start"}),this.scrollTo=null},getReplies(){const e=this,t=`${this.$api("THREAD_REPLIES").url.replace("{pk}",this.thread.id)}?page_size=${this.pageSize}`;this.$axios({method:this.$api("THREAD_REPLIES").method,url:t}).then(function(a){e.nextLink=a.data.pagination.next_link,e.replies=a.data.data,e.replying=new Array(e.replies.length).fill(!1),e.textareas=new Array(e.replies.length).fill(null),e.commenting=!1,e.newComment=null,e.init=!0,e.scrollTo&&setTimeout(e.scrollToReply,300)}).catch(function(a){e.$toast.error(e.$error(a,"THREAD_REPLIES"))})},updateData(){this.replyCount=this.replies.length,this.replying=new Array(this.replies.length).fill(!1),this.textareas=new Array(this.replies.length).fill(null),this.commenting=!1,this.newComment=null,this.loading=!1},getMoreReplies(){if(!this.nextLink)return;const e=this;this.loading=!0,this.$axios({method:this.$api("THREAD_REPLIES").method,url:this.nextLink}).then(function(t){e.nextLink=t.data.pagination.next_link,e.dataStored=t.data.data,setTimeout(e.updateData,1e3)}).catch(function(t){e.$toast.error(e.$error(t,"THREAD_REPLIES"))})},cancelReply(e){e==-1?(this.commenting=!1,this.newComment=null):(this.replying[e]=!1,this.textareas[e]=null)},saveReply(e,t){const a=this;let m={reply_id:t,content:this.textareas[e]};e==-1&&(m={content:this.newComment}),this.$axios({method:this.$api("THREAD_REPLY").method,url:this.$api("THREAD_REPLY").url.replace("{pk}",this.thread.id),data:m}).then(function(r){let d=m;d.id=a.replies.length+1,d.thread=a.thread,d.user={id:2,username:"1@a.com",call_name:"John Doe"},d.is_deleted=!1,d.date_or_time={date:null,time:new Date().toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0})},d.editable=!0,a.replies.splice(e+1,0,d),a.updateData()}).catch(function(r){a.$toast.error(a.$error(r,"THREAD_REPLY"))})},deleteReply(e,t){const a=this;confirm(this.$t("forum.DELETE_REPLY"))&&this.$axios({method:this.$api("REPLY_DELETE").method,url:this.$api("REPLY_DELETE").url.replace("{pk}",e)}).then(function(m){a.replies[t].is_deleted=!0,a.updateData(),a.$toast.success(a.$t("message.REAL_DELETED_SUCCESSFULLY"))}).catch(function(m){a.$toast.error(a.$error(m,"REPLY_DELETE"))})}}},J={key:1,class:"text-right"},W={class:"font-weight-bold"},q={style:{color:"#565E6C"}},K={key:0,class:"text-right"},Q={key:0};function X(e,t,a,m,r,d){const R=L("Observer");return n(),h(x,{class:"pa-0"},{default:o(()=>[E("div",null,[s(C,{variant:"flat",color:"neutral","prepend-icon":"mdi-message-reply-outline",class:"px-4 mr-2"},{default:o(()=>[c(l(r.replyCount),1)]),_:1}),a.thread.forum.permissions.reply?(n(),h(p,{key:0,variant:"outlined","prepend-icon":"mdi-plus",color:"secondary",class:"my-5",onClick:t[0]||(t[0]=u=>r.commenting=!0)},{default:o(()=>[c(l(e.$t("forum.ADD_COMMENT")),1)]),_:1})):f("",!0),r.commenting?(n(),T("div",J,[s($,{modelValue:r.newComment,"onUpdate:modelValue":t[1]||(t[1]=u=>r.newComment=u),rows:"3",variant:"outlined"},null,8,["modelValue"]),s(p,{variant:"flat",density:"comfortable",color:"ashen",class:"mr-2",onClick:t[2]||(t[2]=u=>d.cancelReply(-1))},{default:o(()=>[c(l(e.$t("action.CANCEL")),1)]),_:1}),s(p,{variant:"flat",density:"comfortable",color:"secondary",onClick:t[3]||(t[3]=u=>d.saveReply(-1,0)),disabled:!r.newComment},{default:o(()=>[c(l(e.$t("action.SAVE")),1)]),_:1},8,["disabled"])])):f("",!0)]),(n(!0),T(P,null,H(r.replies,(u,i)=>(n(),h(v,{variant:"flat",key:u.id,id:"reply-"+u.id,class:N(u.reply_id?"ml-5":""),disabled:u.is_deleted},{default:o(()=>[s(g,{class:"pb-2"},{default:o(()=>[u.user&&u.user.id==a.thread.user.id?(n(),h(C,{key:0,variant:"flat",density:"compact",color:"secondary",class:"mr-2 px-2"},{default:o(()=>[c(l(e.$t("forum.AUTHOR")),1)]),_:1})):f("",!0),E("span",W,l(m.username(u)),1),E("span",q," - "+l(m.formatDateOrTime(u.date_or_time)),1)]),_:2},1024),u.is_deleted?(n(),h(g,{key:1,class:"py-1"},{default:o(()=>[c(l(e.$t("forum.DELETED_COMMENT")),1)]),_:1})):(n(),h(g,{key:0,class:"py-1"},{default:o(()=>[c(l(u.content)+" ",1),s(Y,{class:"pl-0 d-flex"},{default:o(()=>[a.thread.forum.permissions.reply?(n(),h(p,{key:0,variant:"text","prepend-icon":"mdi-message-reply-outline",onClick:_=>r.replying[i]=!0},{default:o(()=>[c(l(e.$t("forum.REPLY")),1)]),_:2},1032,["onClick"])):f("",!0),u.editable?(n(),h(p,{key:1,variant:"text","prepend-icon":"mdi-trash-can-outline",color:"secondary",onClick:_=>d.deleteReply(u.id,i)},{default:o(()=>[c(l(e.$t("action.DELETE")),1)]),_:2},1032,["onClick"])):f("",!0)]),_:2},1024),r.replying[i]?(n(),T("div",K,[s($,{modelValue:r.textareas[i],"onUpdate:modelValue":_=>r.textareas[i]=_,rows:"3",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"]),s(p,{variant:"flat",density:"comfortable",color:"ashen",class:"mr-2",onClick:_=>d.cancelReply(i)},{default:o(()=>[c(l(e.$t("action.CANCEL")),1)]),_:2},1032,["onClick"]),s(p,{variant:"flat",density:"comfortable",color:"secondary",onClick:_=>d.saveReply(i,u.id),disabled:!r.textareas[i]},{default:o(()=>[c(l(e.$t("action.SAVE")),1)]),_:2},1032,["onClick","disabled"])])):f("",!0)]),_:2},1024))]),_:2},1032,["id","class","disabled"]))),128)),r.loading?(n(),T("div",Q,[s(F,{indeterminate:"",height:1,color:"secondary"})])):f("",!0),s(R,{onShow:d.getMoreReplies},null,8,["onShow"])]),_:1})}const Z=w(j,[["render",X],["__scopeId","data-v-e6d3a571"]]);const ee={setup(){const{formatDateTime:e}=V(),{fileSize:t}=O(),{username:a}=S();return{formatDateTime:e,fileSize:t,username:a}},components:{Reply:Z},data(){return{thread:null,deleteDialog:!1,init:!1}},mounted(){this.getThread(this.$route.params.forum,this.$route.params.thread)},methods:{backToList(){const e=this.$router.options.history.state.back;e&&e.startsWith("/forum/")?this.$router.back():this.$router.push({name:"thread"})},getThread(e,t){const a=this;this.$axios({method:this.$api("THREAD_READ").method,url:this.$api("THREAD_READ").url.replace("{forum}",e).replace("{pk}",t)}).then(function(m){a.thread=m.data.data,a.init=!0}).catch(function(m){a.$toast.error(a.$error(m,"THREAD_READ"))})},togglePin(){const e=this;let t="THREAD_PIN";this.thread.is_pinned&&(t="THREAD_UNPIN"),this.$axios({method:this.$api(t).method,url:this.$api(t).url.replace("{forum}",this.thread.forum.name).replace("{pk}",this.thread.id)}).then(function(a){e.thread.is_pinned=!e.thread.is_pinned,e.thread.is_pinned?e.$toast.success(e.$t("forum.THREAD_PINNED")):e.$toast.success(e.$t("forum.THREAD_UNPINNED"))}).catch(function(a){e.$toast.error(e.$error(a,t))})},editThread(){this.$router.push({name:"thread.edit",params:{forum:this.$route.params.forum,thread:this.$route.params.thread}})},deleteThread(){const e=this;this.$axios({method:this.$api("THREAD_DELETE").method,url:this.$api("THREAD_DELETE").url.replace("{forum}",this.thread.forum.name).replace("{pk}",this.thread.id)}).then(function(t){e.deleteDialog=!1,e.$toast.success(e.$t("message.DELETED_SUCCESSFULLY")),e.backToList()}).catch(function(t){e.$toast.error(e.$error(t,"THREAD_DELETE"))})},restoreThread(){const e=this;this.$axios({method:this.$api("THREAD_RESTORE").method,url:this.$api("THREAD_RESTORE").url.replace("{forum}",this.thread.forum.name).replace("{pk}",this.thread.id)}).then(function(t){e.deleteDialog=!1,e.$toast.success(e.$t("message.RESTORED_SUCCESSFULLY")),e.backToList()}).catch(function(t){e.$toast.error(e.$error(t,"THREAD_RESTORE"))})},downloadFile(e){I("GET",e.file,e.filename)}}},te={class:"d-flex flex-row"},oe={class:"ml-3 text-body-2"},re={class:"font-weight-bold"},ae={class:"ml-1 font-weight-regular"},se={key:1},le={key:2};function ie(e,t,a,m,r,d){const R=L("router-link"),u=L("Reply");return r.init?(n(),h(x,{key:0},{default:o(()=>[s(D,{style:{"border-bottom":"1px solid #DEE1E6FF"}},{default:o(()=>[s(y,{class:"py-2"},{default:o(()=>[E("div",te,[s(p,{icon:"mdi-arrow-left",size:"small",color:"ashen",onClick:d.backToList},null,8,["onClick"]),E("div",oe,[E("div",re,[s(R,{to:{name:"thread"}},{default:o(()=>[c(l(r.thread.forum.name),1)]),_:1})]),E("div",null,[c(l(m.username(r.thread))+" ",1),E("span",ae," - "+l(m.formatDateTime(r.thread.created_at)),1)])])])]),_:1}),r.thread.editable?(n(),h(y,{key:0,cols:"2",class:"text-right py-2 d-flex justify-end"},{default:o(()=>[r.thread.is_deleted?f("",!0):(n(),h(k,{key:0,location:"bottom",text:e.$t("action.EDIT")},{activator:o(({props:i})=>[s(p,b(i,{icon:"mdi-pencil-outline",density:"comfortable",variant:"text",color:"secondary",class:"ml-1",onClick:d.editThread}),null,16,["onClick"])]),_:1},8,["text"])),r.thread.is_deleted?(n(),h(p,{key:1,variant:"outlined","prepend-icon":"mdi-restore",color:"secondary",onClick:d.restoreThread},{default:o(()=>[c(l(e.$t("action.RESTORE_THREAD")),1)]),_:1},8,["onClick"])):(n(),h(k,{key:2,location:"bottom",text:e.$t("action.DELETE_THREAD")},{activator:o(({props:i})=>[s(p,b(i,{icon:"mdi-trash-can-outline",density:"comfortable",variant:"text",color:"pale",class:"ml-1",onClick:t[0]||(t[0]=_=>r.deleteDialog=!0)}),null,16)]),_:1},8,["text"]))]),_:1})):f("",!0)]),_:1}),s(D,null,{default:o(()=>[s(y,{class:N(["mt-2 mb-5 text-h4",r.thread.is_pinned?"font-weight-bold":""])},{default:o(()=>[r.thread.is_pinned?(n(),h(A,{key:0,icon:"mdi-pin-outline",size:"x-small"})):f("",!0),e.$store.isStaff&&!r.thread.is_deleted?(n(),T("span",se,[E("a",{style:{cursor:"pointer"},onClick:t[1]||(t[1]=(...i)=>d.togglePin&&d.togglePin(...i))},[s(k,{activator:"parent",location:"bottom"},{default:o(()=>[c(l(e.$t("action.TOGGLE_PIN")),1)]),_:1}),c(" "+l(r.thread.title),1)])])):(n(),T("span",le,l(r.thread.title),1))]),_:1},8,["class"])]),_:1}),s(D,null,{default:o(()=>[s(y,null,{default:o(()=>[s(z,{class:"editor-content",innerHTML:r.thread.content},null,8,["innerHTML"])]),_:1})]),_:1}),r.thread.files.length>0?(n(),h(D,{key:0,class:"mt-10"},{default:o(()=>[s(y,null,{default:o(()=>[s(v,{variant:"plain",class:"pb-2 px-1"},{default:o(()=>[s(M,{class:"py-0 text-body-1"},{default:o(()=>[c(l(e.$t("forum.ATTACHMENTS")),1)]),_:1}),(n(!0),T(P,null,H(r.thread.files,i=>(n(),h(C,{key:i.id,variant:"outlined",class:"mx-1 my-1",onClick:_=>d.downloadFile(i)},{default:o(()=>[c(l(i.filename)+" ("+l(m.fileSize(i.size))+") ",1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})):f("",!0),s(G,{modelValue:r.deleteDialog,"onUpdate:modelValue":t[4]||(t[4]=i=>r.deleteDialog=i),"max-width":"400",persistent:""},{default:o(()=>[s(v,{title:e.$t("forum.DELETE_THREAD"),text:e.$t("hint.DELETE_THREAD_DESCRIPTION")},{prepend:o(()=>[s(A,{icon:"mdi-alert",color:"secondary"})]),actions:o(()=>[s(B),s(p,{variant:"outlined",color:"pale",onClick:t[2]||(t[2]=i=>r.deleteDialog=!1)},{default:o(()=>[c(l(e.$t("action.CANCEL")),1)]),_:1}),s(p,{color:"secondary",onClick:t[3]||(t[3]=i=>d.deleteThread())},{default:o(()=>[c(l(e.$t("action.DELETE_THREAD")),1)]),_:1})]),_:1},8,["title","text"])]),_:1},8,["modelValue"]),s(u,{class:"mt-5",thread:r.thread},null,8,["thread"])]),_:1})):f("",!0)}const $e=w(ee,[["render",ie]]);export{$e as default};
